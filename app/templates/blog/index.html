{% extends "base.html" %}

{% block title %}Blog Home{% endblock %}

{% block extra_css %}
<style>
    

    
</style>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container">
    <header class="mb-4 text-center">
        <h1 class="display-4">My Blog</h1>
        <nav class="mt-3">
            <a href="{{ url_for('blog.index') }}" class="btn btn-link text-decoration-none">Home</a>
            <!-- Add other nav links if needed -->
        </nav>
    </header>

    <!-- Search and Category Filter Form -->
    <form method="GET" class="mb-4">
        <div class="row g-3">
            <div class="col-md-5">
                <input type="text" name="q" class="form-control" placeholder="Search posts..." value="{{ q or '' }}">
            </div>
            <div class="col-md-5">
                <select name="cat" class="form-select">
                    <option value="">All Categories</option>
                    <!-- Pass categories from route to populate -->
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
            </div>
        </div>
    </form>

    <main>
        {% if posts %}
            {% for post in posts %}
                <article class="post mb-4">
                    <div class="p-4">
                        <h2 class="h4 mb-2">
                            <a href="{{ url_for('blog.view_post', slug=post.slug) }}">{{ post.title }}</a>
                        </h2>
                        <p class="text-muted small mb-3">
                            By {{ post.user.username }} | {{ post.created_at.strftime('%b %d, %Y') }}
                            {% if post.views %} | {{ post.views }} views{% endif %}
                        </p>
                        {% if post.media_filename %}
                            <img src="{{ url_for('static', filename='uploads/media/' + post.media_filename) }}" alt="{{ post.title }}">

                                 
                        {% endif %}
                        <p class="lead mb-3">{{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}</p>
                        <a href="{{ url_for('blog.view_post', slug=post.slug) }}" class="btn btn-primary">Read more</a>
                    </div>
                    <hr class="m-0">
                </article>
            {% endfor %}

            <!-- Pagination -->
            {% if total_pages > 1 %}
                <nav aria-label="Post pagination" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if has_prev %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('blog.index', page=page-1, q=q or '', cat=cat or '') }}">Previous</a>
                            </li>
                        {% endif %}
                        <li class="page-item active">
                            <span class="page-link">{{ page }} of {{ total_pages }}</span>
                        </li>
                        {% if has_next %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('blog.index', page=page+1, q=q or '', cat=cat or '') }}">Next</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
        {% else %}
            <div class="text-center py-5">
                <h3 class="text-muted">No posts yet.</h3>
                {% if q or cat %}<p><a href="{{ url_for('blog.index') }}" class="btn btn-outline-secondary">Clear Filters</a></p>{% endif %}
            </div>
        {% endif %}
    </main>
</div>
{% endblock %}